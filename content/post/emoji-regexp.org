#+title: Emoji æ­£åˆ™åŒ¹é…
#+date: 2024-05-09T20:28:46+08:00
#+lastmod: 2024-05-09T20:28:46+08:00
#+draft: true
#+keywords[]:
#+description: ""
#+tags[]:
#+categories[]:

* å‰è¨€

è¦æ±‚è¾“å…¥æ¡†èƒ½è¾“å…¥é™¤äº†ç‰¹æ®Šè¡¨æƒ…å¤–çš„ä»»æ„å­—ç¬¦ã€‚

æˆ‘çš„ç†è§£å°±æ˜¯å°† Emoji æ’é™¤æ‰ï¼Œé€šè¿‡ [[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp][RegExp]] åŒ¹é…åˆ° Emojiï¼Œå¦‚æœåŒ¹é…åˆ°åˆ™è¯´æ˜å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ŒåŒ¹é…ä¸åˆ°åˆ™è®¤ä¸ºé€šè¿‡ã€‚

* TL;DR

å¦‚æœä½ åªæ˜¯æƒ³è¦ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…è¡¨æƒ…çš„æ­£åˆ™ï¼Œä¸‹é¢è¿™ä¸ªåº”è¯¥å°±æ»¡è¶³ğŸ‘‡ï¼š

#+begin_src typescript
    /\p{Extended_Pictographic}/gu.test("ä½ å¥½hello123ğŸ˜„hiğŸŒ·456ğŸ‰") // true
    /\p{Extended_Pictographic}/gu.test("ä½ å¥½hello123") // false
#+end_src

[[file:/post/emoji-regexp/regexp101-emoji-corret.png]]

* è§£å†³è¿‡ç¨‹

å¯¹äº Emoji è¿™ç§æ­£åˆ™ï¼Œä¸€å¼€å§‹æƒ³ä¸åˆ°å¦‚ä½•æ„å»ºï¼Œç†è®ºä¸Šå®ƒä¹Ÿæ˜¯å±äº Stringï¼Œå¤§è‡´çŸ¥é“æ˜¯ç”¨ Unicode ç¼–ç è¡¨ç¤ºçš„ï¼Œä½†æ€ä¹ˆç”¨æ­£åˆ™æè¿°å®ƒå‘¢ï¼Ÿ

æ‰€ä»¥æˆ‘çš„ç¬¬ä¸€æ­¥æ˜¯ Googleï¼Œå¾—åˆ°ä¸€ä¸ªè¿™æ ·çš„æ­£åˆ™ï¼š

#+begin_src typescript
    /(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/
#+end_src

æ‹¿å» [[https://regex101.com/][regex101]] æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè™½ç„¶èƒ½åŒ¹é…åˆ°ä¸€äº› Emojiï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰éƒ¨åˆ† Emoji åŒ¹é…ä¸åˆ°ã€‚

[[file:/post/emoji-regexp/regexp101-emoji-wrong.png]]

ä¸Šé¢çš„æ­£åˆ™è¡¨è¾¾å¼åº”è¯¥æ˜¯è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª Unicode å­—ç¬¦èŒƒå›´ï¼Œéƒ¨åˆ† Emoji (ğŸ‰)æ²¡åŒ¹é…ä¸Šï¼Œè¯´æ˜è¿™ä¸ªèŒƒå›´å°äº†ï¼Œæ²¡æœ‰å›Šæ‹¬æ‰€æœ‰çš„ Emojiã€‚

é‚£ä¹ˆ Emoji çš„ Unicode èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿæ˜¯ä¸æ˜¯ç©·ä¸¾å°±è¡Œäº†ï¼Ÿ

å…¶å®æ²¡åŠæ³•ç”¨ä¸€ä¸ªå›ºå®šçš„èŒƒå›´å»è¡¨è¾¾ï¼Œå› ä¸º Emoji æ˜¯æŒç»­å¢åŠ çš„ï¼Œæ¯å¢åŠ ä¸€ä¸ªå°±ä¼šå¤šä¸€ä¸ª Unicode å»æ‰¿è½½ï¼Œæ²¡åŠæ³•ç”¨ä¸€ä¸ªå›ºå®šçš„èŒƒå›´å»è¡¨è¾¾æ‰€æœ‰çš„ Emojiã€‚

äºæ˜¯åˆæœç´¢äº†ä¸€ä¸‹ï¼ŒStackOverflow æœ‰ä¸€ä¸ª[[https://stackoverflow.com/questions/18862256/how-to-detect-emoji-using-javascript][æé—®]]ï¼Œé‡Œé¢æåˆ°äº†ç”¨ [[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape][Unicode character class escape]] è¿›è¡ŒåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯:

- ~/\p{Emoji}/u~ :: æ—¢ç„¶æ˜¯åŒ¹é… Emojiï¼Œé‚£ä¹ˆ loneProperty å°±åº”è¯¥æ˜¯ Emoji ? å®é™…æµ‹è¯•å¹¶ä¸ç¬¦åˆéœ€æ±‚ï¼Œå› ä¸ºåœ¨ [[https://www.unicode.org/Public/15.1.0/ucd/emoji/emoji-data.txt][Emoji å®˜æ–¹æ–‡æ¡£]]ä¸­ï¼Œ =123456789*#= ä¹Ÿæ˜¯è¢«çœ‹ä½œæ˜¯ Emojiï¼Œ
  å¦‚æœç”¨è¿™ä¸ªæ­£åˆ™çš„è¯ï¼Œå°±ä¼šæŠŠæ•°å­—ä¹Ÿè®¤ä¸ºæ˜¯ Emojiï¼Œä¸ç¬¦åˆåªæ’é™¤ç‰¹æ®Šè¡¨æƒ…çš„æ¡ä»¶ã€‚

- ~/\p{Extended_Pictographic}/u~ :: è€Œ Extended_Pictographic è¡¨ç¤ºçš„ Emoji æ‰æ˜¯æˆ‘ä»¬è®¤ä¸ºçš„é‚£äº›è¡¨æƒ…ç¬¦å·ã€‚

#+begin_src typescript
  console.log(
    /\p{Emoji}/u.test('flowers'), // false :)
    /\p{Emoji}/u.test('flowers ğŸŒ¼ğŸŒºğŸŒ¸'), // true :)
    /\p{Emoji}/u.test('flowers 123'), // true :(
  )
  console.log(
    /\p{Extended_Pictographic}/u.test('flowers'), // false :)
    /\p{Extended_Pictographic}/u.test('flowers ğŸŒ¼ğŸŒºğŸŒ¸'), // true :)
    /\p{Extended_Pictographic}/u.test('flowers 123'), // false :)
  )
#+end_src

* Unicode character class escpae

[[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape][Unicode character class escape: \p{...}, \P{...}]] æ˜¯ [[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Regular_expressions/Character_class_escape][Character class escape]] ä¸­çš„ä¸€ç§ã€‚

å¹³æ—¶æ­£åˆ™ä¸­å¸¸ç”¨çš„ \d,\D,\w,\W å°±æ˜¯ Character class escapeï¼Œå°±æ˜¯ç”¨æ¥è¡¨è¾¾ä¸€ç»„å­—ç¬¦çš„è½¬ä¹‰åºåˆ—(escape sequence)ã€‚

ä¾‹å¦‚ =\d= è¡¨è¾¾çš„å°±æ˜¯ =[0-9]=  ã€‚

è€Œ =\p{...}= , =\P{...}= ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯ä»–ä»¬ç”¨æ¥è¡¨è¾¾ä¸€ç»„ Unicdoe å­—ç¬¦ï¼Œé€šè¿‡æŒ‡å®š [[https://tc39.es/ecma262/multipage/text-processing.html#sec-runtime-semantics-unicodematchproperty-p][Unicode property]] å†³å®šåŒ¹é…ä»€ä¹ˆ Unicodeã€‚

ä¾‹å¦‚å¯ä»¥ç”¨ =/\p{Hex_Digit}/u= å»åŒ¹é… 16 è¿›åˆ¶çš„å­—ç¬¦ï¼š

[[file:/post/emoji-regexp/regexp101-emoji-hex-digit.png]]

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Unicode character class escpae è¦å¯ç”¨ [[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/unicode#unicode-aware_mode][unicode-aware mode]]ï¼Œå³åŠ ä¸Š =/u= æ ‡è®°ã€‚

* Refs

- [[https://stackoverflow.com/questions/18862256/how-to-detect-emoji-using-javascript][How to detect emoji using javascript]]

- [[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape][Unicode character class escape: \p{...}, \P{...}]]

- [[https://tc39.es/ecma262/multipage/text-processing.html#table-binary-unicode-properties][Binary Unicode property aliases and their canonical property names]]
